name: ğŸš€ æ„å»ºå‘è´§åŠ©æ‰‹APK

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  build-apk:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      
    - name: ğŸ è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: â˜• è®¾ç½®Javaç¯å¢ƒ
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'
        
    - name: ğŸ“¦ å®‰è£…ç³»ç»Ÿä¾èµ–
      run: |
        sudo apt-get update
        sudo apt-get install -y git zip unzip openjdk-17-jdk autoconf libtool pkg-config zlib1g-dev libncurses5-dev libncursesw5-dev libtinfo5 cmake libffi-dev libssl-dev
        
    - name: ğŸ”§ å®‰è£…Pythonä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install buildozer cython==0.29.33
        
    - name: ğŸ—ï¸ æ„å»ºAPK
      working-directory: ./
      run: |
        # ç¡®ä¿buildozer.specå­˜åœ¨
        if [ ! -f "buildozer.spec" ]; then
          echo "âŒ buildozer.specæ–‡ä»¶ä¸å­˜åœ¨"
          exit 1
        fi
        
        # å¼€å§‹æ„å»º
        echo "ğŸš€ å¼€å§‹æ„å»ºAPK..."
        buildozer android debug
        
    - name: ğŸ“± ä¸Šä¼ APKæ–‡ä»¶
      uses: actions/upload-artifact@v4
      with:
        name: å‘è´§åŠ©æ‰‹-APK
        path: ./bin/*.apk
        retention-days: 30
        
    - name: ğŸ“‹ æ˜¾ç¤ºæ„å»ºä¿¡æ¯
      run: |
        echo "âœ… APKæ„å»ºå®Œæˆï¼"
        echo "ğŸ“¦ æ–‡ä»¶ä½ç½®ï¼š./bin/"
        ls -la ./bin/ || echo "binç›®å½•ä¸å­˜åœ¨"
        echo "ğŸ“¥ è¯·åœ¨Actionsé¡µé¢ä¸‹è½½APKæ–‡ä»¶"
